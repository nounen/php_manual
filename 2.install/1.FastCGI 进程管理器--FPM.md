### FastCGI 进程管理器（FPM）
* http://php.net/manual/zh/install.fpm.php

* FPM（FastCGI 进程管理器）用于替换 PHP FastCGI 的大部分附加功能，对于高负载网站是非常有用的。

* 它的功能包括: 
    * 支持平滑停止/启动的高级进程管理功能;

    * 可以工作于不同的 uid/gid/chroot 环境下，并监听不同的端口和使用不同的 php.ini 配置文件（可取代 safe_mode 的设置）;

    * stdout 和 stderr 日志记录;

    * 在发生意外情况的时候能够重新启动并缓存被破坏的 opcode;

    * 文件上传优化支持;

    * "慢日志" - 记录脚本（不仅记录文件名，还记录 PHP backtrace 信息，可以使用 ptrace或者类似工具读取和分析远程进程的运行数据）运行所导致的异常缓慢;

    * fastcgi_finish_request() - 特殊功能: 用于在请求完成和刷新数据后，继续在后台执行耗时的工作（录入视频转换、统计处理等）;

    * 动态／静态子进程产生;

    * 基本 SAPI 运行状态信息（类似Apache的 mod_status）;

    * 基于 php.ini 的配置文件.


* ubuntu 下 php-fpm 相关命令:
```shell
/etc/php/7.0/fpm/php-fpm.conf   // php-fpm 配置文件位置

sudo service php7.0-fpm status  // 查看 php-fpm 状态
sudo service php7.0-fpm start   // 启动 php-fpm 服务

ps -ef  // 查看所有进程
ps -ef | grep php-fpm   // 查看 php-fpm 所有的进程

netstat -tnlp   // 查看监听端口
netstat -tnlp | grep 9000   // 查看监听端口
```

* php-fpm 设置监听方式 -- Nginx 连接 fastcgi 的方式有2种：TCP 和 unix domain socket
```
sudo vim /etc/php/7.0/fpm/pool.d/www.conf 

```

* nginx php-fpm 配置:
```
// 走 tcp
server {                                                                       
    listen 8000;                                                               
    root /mnt/e/codes/php_manual;                                              
    index index.php index.html;                                                
    server_name www.php-cgi.test;                                              
                                                                            
    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000       
    location ~ \.php$ {                                                        
        include snippets/fastcgi-php.conf;                                     
        # With php7.0-cgi alone:                                               
        fastcgi_pass 127.0.0.1:9000;                                           
    }                                                                          
}                                                                              

// 走 unix 套接字                                                             
server {                                                                       
    listen 8000;                                                               
    root /mnt/e/codes/php_manual;                                              
    index index.php index.html;                                                
    server_name www.php-fpm.test;                                              
                                                                            
    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000       
    location ~ \.php$ {                                                        
        include snippets/fastcgi-php.conf;                                     
        # With php7.0-fpm:                                                     
        fastcgi_pass unix:/run/php/php7.0-fpm.sock;                            
    }                                                                          
}                                                                              
```
